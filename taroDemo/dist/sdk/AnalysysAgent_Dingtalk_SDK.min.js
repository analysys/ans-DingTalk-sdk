"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e={base:{outer:["appid","xwho","xwhat","xwhen","xcontext"],xcontext:["$lib","$lib_version","$platform","$debug","$is_login"]},$startup:{xcontext:["$brand","$model","$os","$os_version","$browser","$browser_version","$network","$screen_width","$screen_height","$utm_campaign_id","$utm_campaign","$utm_medium","$utm_source","$utm_content","$utm_term","$is_first_day","$time_zone","$language","$session_id","$is_time_calibrated","$is_first_time","$referrer","$scene"]},$track:{xcontext:["$brand","$model","$os","$os_version","$browser","$browser_version","$network","$screen_width","$screen_height","$utm_campaign_id","$utm_campaign","$utm_medium","$utm_source","$utm_content","$utm_term","$is_first_day","$time_zone","$language","$session_id","$is_time_calibrated"]},$pageview:{xcontext:["$brand","$model","$os","$os_version","$browser","$browser_version","$network","$screen_width","$screen_height","$utm_campaign_id","$utm_campaign","$utm_medium","$utm_source","$utm_content","$utm_term","$is_first_day","$time_zone","$language","$session_id","$is_time_calibrated","$referrer","$scene","$startup_time","$url","$share_id","$share_path","$share_level"]},$alias:{xcontext:["$original_id"]},$getPresetProperties:{xcontext:["$time_zone","$language","$screen_width","$screen_height","$network","$first_visit_time","$brand","$model","$os","$session_id"]}},t={base:{appid:"",$debug:0,$lib_version:"4.3.0",$lib:"DingTalk",uploadURL:"",auto:!0,autoProfile:!0,encryptType:0,autoShare:!1,$share_level:"",$share_path:"",$share_id:"",appProperty:null,allowTimeCheck:!1,maxDiffTimeInterval:30,logflag:!1},status:{code:200,FnName:"",key:"",value:"",errorCode:"",successCode:""},system:{system:{},netWork:{},scene:{}},isStartUp:!1,FnCatch:[],FnSuperCatch:[],keywords:e.base.xcontext,baseJson:e.base.outer,sendNum:1800},a=Object.freeze({__proto__:null,request:function(e){dd.httpRequest(e)}}),r=Object.freeze({__proto__:null,getStoragePromise:function(a){return new Promise(function(t,e){try{var r=dd.getStorageSync({key:a});r.data?t(r.data):t({})}catch(e){dd.getStorage({key:a,success:function(e){t(e.data)},fail:function(){t({})}})}}).catch(function(e){})},setStoragePromise:function(n,e){return new Promise(function(t,r){var a=e;try{dd.setStorageSync({key:n,data:a}),t(200)}catch(e){dd.setStorage({key:n,data:a,success:function(){t(200)},fail:function(){r(400)}})}}).catch(function(e){})}}),n=Object.freeze({__proto__:null,systemPromise:function(){return new Promise(function(r,t){dd.getSystemInfo({success:function(e){var t={};Object.assign(t,e),t.system=e.platform+" "+e.system,r(t)},fail:function(e){t(e)}})}).catch(function(e){})}}),s=Object.freeze({__proto__:null,netWorkPromise:function(){return new Promise(function(t,r){dd.getNetworkType({success:function(e){t(e)},fail:function(e){r(e)}})}).catch(function(e){})}});function o(){return t.system.scene||""}var u=Object.freeze({__proto__:null,getScene:o,getPackageName:function(){return""},getPath:function(){var e=getCurrentPages();return e[e.length-1].__proto__.route},getTitle:function(){return""},getReferer:function(){var e=getCurrentPages();return 1<e.length?"/"+e[e.length-2].__proto__.route:o()}}),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}}(),l=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},p=new function e(){var t=this;i(this,e),this.AppObj=dd,this.Fetch=a,this.Storage=r,this.System=n,this.Network=s,this.Router=u,this.setPublicApp=function(e){t.AppObj=e},this.getPublicApp=function(){return t.AppObj}},y=p.Storage.getStoragePromise,g=p.Storage.setStoragePromise,v=new(function(){function e(){i(this,e),this.local={},this.Session={},this.localStatus=!1,this.getStoragePromise=p.Storage.getStoragePromise}return c(e,[{key:"initLocalData",value:function(){var e=this;return y("FZ_STROAGE").then(function(t){if(!e.localStatus){if(e.localStatus=!0,"string"==typeof(t=t||{}))try{t=JSON.parse(t)}catch(e){t={}}e.local=Object.assign(t,e.local),g("FZ_STROAGE",e.local).then(function(){},function(e){}).catch(function(e){})}},function(){e.local={}}).catch(function(e){console.log(e.message)})}},{key:"setData",value:function(e,t){this.Session[e]=t}},{key:"getData",value:function(e){return"undefind"===this.Session[e]?"":this.Session[e]}},{key:"removeData",value:function(e){"undefind"!==this.Session[e]&&delete this.Session[e]}},{key:"clearData",value:function(){this.Session={}}},{key:"setLocal",value:function(e,t){this.local[e]=t;var r=this.local;g("FZ_STROAGE",r).then(function(){},function(e){}).catch(function(e){})}},{key:"getLocal",value:function(e){return this.local[e]}},{key:"removeLocal",value:function(e){if("undefind"!==this.local[e]){delete this.local[e];var t=this.local;g("FZ_STROAGE",t).then(function(){},function(){}).catch(function(e){})}}}]),e}()),f=new(function(){function e(){i(this,e)}return c(e,[{key:"paramType",value:function(e){return Object.prototype.toString.call(e).replace("[object ","").replace("]","")}},{key:"delEmpty",value:function(e){var r=this,a=this.deepClone(e);return"Object"!==this.paramType(a)?{}:(Object.keys(a).forEach(function(e){var t=a[e];"Object"===r.paramType(t)&&(a[e]=r.delEmpty(a[e]),0===Object.keys(a[e]).length&&delete a[e]),""===t&&delete a[e]}),a)}},{key:"deepClone",value:function(e){var t=Object.getPrototypeOf(e);return Object.assign({},Object.create(t),e)}},{key:"mergeMsg",value:function(e,t){Object.assign(t,e)}},{key:"checkObj",value:function(e,t){var r={};if(1!==arguments.length||e.constructor!==Array)return 1===arguments.length&&e.constructor===String?r[e]=t||"":1<arguments.length&&e.constructor!==Object?r[e]=t:r=e,r;for(var a=0;a<e.length;a++)r[e[a]]="";return r}},{key:"isFristDay",value:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1;r=r<10?"0"+r:r;var a=e.getDate(),n=t+""+r+(a=a<10?"0"+a:a),s=v.getLocal("FRISTDAY");return!(s&&n!==s||(s||v.setLocal("FRISTDAY",n),0))}},{key:"isFristTime",value:function(){var e=!1!==v.getLocal("FRISTIME");return e&&v.setLocal("FRISTIME",!1),e}},{key:"isEmptyObject",value:function(e){return!(0<Object.keys(e).length)}},{key:"setFristDay",value:function(){if("String"!==this.paramType(v.getLocal("FRISTDAY"))){var e=this.format(new Date,"yyyyMMdd");t.base.allowTimeCheck&&t.base.logflag&&(e=this.format(new Date(+new Date+(v.getLocal("ANSSERVERTIME")?Number(v.getLocal("ANSSERVERTIME")):0)),"yyyyMMdd")),v.setLocal("FRISTDAY",e)}}},{key:"setFristTime",value:function(){"Boolean"!==this.paramType(v.getLocal("FRISTIME"))&&v.setLocal("FRISTIME",!0)}},{key:"delFristDay",value:function(){v.removeLocal("FRISTDAY")}},{key:"delFristTime",value:function(){v.removeLocal("FRISTIME")}},{key:"checkURL",value:function(e){var t=e;return 1==new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/).test(t)}},{key:"firstVisitTime",value:function(){var e=!1!==v.getLocal("FIRSTVISITTIME");return e&&v.setLocal("FIRSTVISITTIME",!1),e}},{key:"toDeepObj",value:function(e,t){var r={};if("String"===this.paramType(e))return this.keyValueToObje(e,t);if("Array"===this.paramType(e))return this.ArrayToObj(e);if("Object"===this.paramType(e))for(var a in e)r[a]=this.toDeepObj(e[a]);return r}},{key:"ArrayToObj",value:function(e){for(var t={},r=0;r<e.length;r++)t[e[r]]="";return t}},{key:"keyValueToObje",value:function(e,t){var r={};return r[e]=t||"",r}},{key:"toObj",value:function(e,t){var r={};return"String"===this.paramType(e)?r=this.keyValueToObje(e,t):"Array"===this.paramType(e)?r=this.ArrayToObj(e):"Object"===this.paramType(e)?e:r}},{key:"objMerge",value:function(e,t){if("Object"!==this.paramType(e)||"Object"!==this.paramType(t))return e;var r={};for(var a in e)r[a]=e[a];for(var a in t)r[a]&&"Object"===this.paramType(r[a])&&"Object"===this.paramType(t[a])?r[a]=this.objMerge(r[a],t[a]):"Array"===this.paramType(r[a])&&"Array"===this.paramType(t[a])?r[a]=this.arrayMergeUnique(r[a],t[a]):r[a]=t[a];return r}},{key:"arrayUnique",value:function(e){for(var t=[],r={},a=0;a<e.length;a++)r[e[a]]||(r[e[a]]=!0,t.push(e[a]));return t}},{key:"arrayMerge",value:function(e,t){return e.push.apply(e,t),e}},{key:"arrayMergeUnique",value:function(e,t){return e.push.apply(e,t),this.arrayUnique(e)}},{key:"format",value:function(e,t){var r=e.getTimezoneOffset(),a={"M+":(e=new Date(e.getTime()+60*r*1e3+288e5)).getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),"S+":e.getMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,3==RegExp.$1.length?(""+a[n]).length<3?("00"+a[n]).substr(("00"+a[n]).length-3,("00"+a[n]).length):a[n]:("00"+a[n]).substr((""+a[n]).length)));return t}},{key:"objHasKay",value:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},{key:"clientTimeZone",value:function(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60),r=e%60,a="-";return(t<=0||r<0)&&(a="+",t=-t,r<0&&(r=-r)),1==(t+="").length&&(t="0"+t),1==(r+="").length&&(r="0"+r),a+t+":"+r}},{key:"objInArray",value:function(e){var t=[];return t.push(e),t}},{key:"stringSlice",value:function(e,t){return e.slice(0,t)}}]),e}()),m={common:"{FN}:Property key invalid, nonsupport value: $lib/$lib_version/$platform/$first_visit_time/$debug/$is_login \ncurrent KEY:{KEY}",60001:"{FN}:Property key invalid, support type: String \ncurrent key:{KEY}\ncurrent keyType:{KEYTYPE}",60002:"{FN}:Property value invalid of key[{KEY}], support type: Number \ncurrent value:{VALUE}\ncurrent type: {VALUETYPE}",60003:"{FN}:Property value invalid of key[{KEY}], support type: Boolean \ncurrent value:{VALUE}\ncurrent type: {VALUETYPE}",60004:"{FN}:Property value invalid of key[{KEY}], support type: Array \ncurrent value:{VALUE}\ncurrent type: {VALUETYPE}",60005:"{FN}:The length of the property[{KEY}] value (string[{VALUE}]) needs to be 1-255 !",60006:"Please set appkey first.",60007:"Please set uploadURL first.",60008:"Send message failed.",60009:"{FN}:The length of the property key (string[{KEY}]) needs to be 1-125 !",600010:"{FN}:The length of the property key (string[{KEY}]) needs to be 1-99 !",600011:"{FN}:[{KEY}] does not conform to naming rules!",600012:"{FN}:Property key invalid, nonsupport value: $lib/$lib_version/$platform/$first_visit_time/$debug/$is_login \ncurrent KEY:{KEY}",600013:"{FN}:Property value invalid of key[{KEY}], support type: Array with String as its internal element \ncurrent value:{VALUE}\ncurrent type: {VALUETYPE}",600016:"{FN}:Property value invalid of key[{KEY}], support type: Object \ncurrent value:{VALUE}\ncurrent type: {VALUETYPE}",600017:"{FN}:The length of the property key (string[{KEY}]) needs to be 1-255 !",600018:"{FN}:Property value invalid of key[{KEY}] invalid, support type: String \ncurrent value:{VALUE}\ncurrent type: {VALUETYPE}",600019:"{FN}:The length of the property[{KEY}] value (string[{VALUE}]) needs to be 1-255 !",600020:"DebugMode only can be 0,1,2",600021:"{FN}:Property value invalid of key[{KEY}], support type: Object, Object.keys length needs to be 1-499 \ncurrent length:{VALUE}\n"},h={common:"",20001:"Send message success",20002:"{FN}: set success ({VALUE})",20003:"{FN}:({VALUE}) delete success",20004:"{FN}:clear success",20005:"{FN}:reset success",20006:"set appkey success. current appkey : {VALUE}",20007:"Init Analysys "+t.base.$lib+" sdk success, version : {VALUE}",20008:"set uploadURL success. current uploadURL : {VALUE}",20009:"{FN}:[{KEY}] : get failed",20010:"{FN}:[{KEY}] : get success. ({VALUE})",20011:"{FN}:({VALUE}) delete failed",20012:"Send Message to Server: {KEY} \ndata:{VALUE}",20013:"收到服务器的时间: {VALUE} \n本地时间: {KEY} \n时间相差:  {FN} \n数据将会进行时间校准"};function d(e){if(1===t.base.$debug||2===t.base.$debug){var r=t.status,a=r.successCode,n=r.FnName,s=r.key,o=r.value,u=(h[a]||h.common).replace(/{FN}/,n).replace(/{KEY}/g,s).replace(/{VALUE}/g,o);if(e&&(u=e),!u)return;if("Object"===f.paramType(console)&&console.log)try{return console.log.apply(console,u)}catch(e){console.log(u)}}}function S(){var e=t.status,r=e.errorCode,a=e.FnName,n=e.key,s=JSON.stringify(e.value),o=f.paramType(e.value),u=f.paramType(n),i=(m[r]||m.common).replace(/{FN}/g,a).replace(/{KEY}/g,JSON.stringify(n)).replace(/{VALUE}/g,s).replace(/{VALUETYPE}/g,o).replace(/{KEYTYPE}/g,u);1!==t.base.$debug&&2!==t.base.$debug||console.warn(i)}var b=new(function(){function e(){i(this,e)}return c(e,[{key:"isString",value:function(e){return t.status.errorCode="60001","String"===f.paramType(e)}},{key:"isNumber",value:function(e){return t.status.errorCode="60002","Number"===f.paramType(e)}},{key:"isBoolean",value:function(e){return t.status.errorCode="60003","Boolean"===f.paramType(e)}},{key:"isObject",value:function(e){return"Object"===f.paramType(e)}},{key:"lengthRule",value:function(e,r,a){this.isNumber(a)||(a=1/0);var n=!0;return this.isNumber(r)&&e.length&&e.length>r&&e.length<a+1||(n=!(t.status.errorCode="60005")),n}},{key:"nimLength",value:function(e){return this.lengthRule(e,0)}},{key:"length99",value:function(e){var r=this.lengthRule(e,0,99);return r||(t.status.errorCode="600010"),r}},{key:"length125",value:function(e){var r=this.lengthRule(e,0,125);return r||(t.status.errorCode="60009"),r}},{key:"length255",value:function(e){if(!(e||this.isString(e)||this.isNumber(e)||this.isBoolean(e)))return!(t.status.errorCode="60005");"String"!==f.paramType(e)&&(e=e.toString());var r=this.lengthRule(e,0,255);return r||(t.status.errorCode="600019"),r}},{key:"keyLength255",value:function(e){var r=this.length255(e);return r||(t.status.errorCode="600017"),r}},{key:"isURL",value:function(e){var r=e;return 1==new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/).test(r)||!(t.status.errorCode="60006")}},{key:"isDebug",value:function(e){return!(!this.isNumber(e)||0!==e&&1!==e&&2!==e)}},{key:"notObject",value:function(e){return!this.isObject(e)}},{key:"notSpecialCharacters",value:function(e){return!(new RegExp("[\\u4E00-\\u9FA5]|[\\uFE30-\\uFFA0]","gi").test(e)||!/^[$a-zA-Z][a-zA-Z0-9_$]{0,}$/.test(e))||!(t.status.errorCode="600011")}},{key:"isArrayString",value:function(e){if("Array"===f.paramType(e))for(var r=0;r<e.length;r++){if(t.status.value=e[r],"String"!==f.paramType(e[r]))return!(t.status.errorCode="600013");if(!this.length255(e[r]))return!1}return!0}},{key:"keywords",value:function(e){var r=t.keywords;return t.status.errorCode="600012",!(-1<r.indexOf(e))}}]),e}());function T(e,t){var r=e;function u(e,t){return e<<t|e>>>32-t}function i(e,t){var r,a,n,s,o;return n=2147483648&e,s=2147483648&t,o=(1073741823&e)+(1073741823&t),(r=1073741824&e)&(a=1073741824&t)?2147483648^o^n^s:r|a?1073741824&o?3221225472^o^n^s:1073741824^o^n^s:o^n^s}function a(e,t,r,a,n,s,o){return e=i(e,i(i(t&r|~t&a,n),o)),i(u(e,s),t)}function n(e,t,r,a,n,s,o){return e=i(e,i(i(t&a|r&~a,n),o)),i(u(e,s),t)}function s(e,t,r,a,n,s,o){return e=i(e,i(i(t^r^a,n),o)),i(u(e,s),t)}function o(e,t,r,a,n,s,o){return e=i(e,i(i(r^(t|~a),n),o)),i(u(e,s),t)}function c(e){var t="",r="",a=void 0;for(a=0;a<=3;a++)t+=(r="0"+(e>>>8*a&255).toString(16)).substr(r.length-2,2);return t}var l=Array(),p=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,d=void 0,h=void 0,_=void 0;for(l=function(e){for(var t=void 0,r=e.length,a=r+8,n=16*(1+(a-a%64)/64),s=Array(n-1),o=0,u=0;u<r;)o=u%4*8,s[t=(u-u%4)/4]=s[t]|e.charCodeAt(u)<<o,u++;return o=u%4*8,s[t=(u-u%4)/4]=s[t]|128<<o,s[n-2]=r<<3,s[n-1]=r>>>29,s}(r),g=1732584193,d=4023233417,h=2562383102,_=271733878,p=0;p<l.length;p+=16)g=a(v=g,f=d,y=h,m=_,l[p+0],7,3614090360),_=a(_,g,d,h,l[p+1],12,3905402710),h=a(h,_,g,d,l[p+2],17,606105819),d=a(d,h,_,g,l[p+3],22,3250441966),g=a(g,d,h,_,l[p+4],7,4118548399),_=a(_,g,d,h,l[p+5],12,1200080426),h=a(h,_,g,d,l[p+6],17,2821735955),d=a(d,h,_,g,l[p+7],22,4249261313),g=a(g,d,h,_,l[p+8],7,1770035416),_=a(_,g,d,h,l[p+9],12,2336552879),h=a(h,_,g,d,l[p+10],17,4294925233),d=a(d,h,_,g,l[p+11],22,2304563134),g=a(g,d,h,_,l[p+12],7,1804603682),_=a(_,g,d,h,l[p+13],12,4254626195),h=a(h,_,g,d,l[p+14],17,2792965006),g=n(g,d=a(d,h,_,g,l[p+15],22,1236535329),h,_,l[p+1],5,4129170786),_=n(_,g,d,h,l[p+6],9,3225465664),h=n(h,_,g,d,l[p+11],14,643717713),d=n(d,h,_,g,l[p+0],20,3921069994),g=n(g,d,h,_,l[p+5],5,3593408605),_=n(_,g,d,h,l[p+10],9,38016083),h=n(h,_,g,d,l[p+15],14,3634488961),d=n(d,h,_,g,l[p+4],20,3889429448),g=n(g,d,h,_,l[p+9],5,568446438),_=n(_,g,d,h,l[p+14],9,3275163606),h=n(h,_,g,d,l[p+3],14,4107603335),d=n(d,h,_,g,l[p+8],20,1163531501),g=n(g,d,h,_,l[p+13],5,2850285829),_=n(_,g,d,h,l[p+2],9,4243563512),h=n(h,_,g,d,l[p+7],14,1735328473),g=s(g,d=n(d,h,_,g,l[p+12],20,2368359562),h,_,l[p+5],4,4294588738),_=s(_,g,d,h,l[p+8],11,2272392833),h=s(h,_,g,d,l[p+11],16,1839030562),d=s(d,h,_,g,l[p+14],23,4259657740),g=s(g,d,h,_,l[p+1],4,2763975236),_=s(_,g,d,h,l[p+4],11,1272893353),h=s(h,_,g,d,l[p+7],16,4139469664),d=s(d,h,_,g,l[p+10],23,3200236656),g=s(g,d,h,_,l[p+13],4,681279174),_=s(_,g,d,h,l[p+0],11,3936430074),h=s(h,_,g,d,l[p+3],16,3572445317),d=s(d,h,_,g,l[p+6],23,76029189),g=s(g,d,h,_,l[p+9],4,3654602809),_=s(_,g,d,h,l[p+12],11,3873151461),h=s(h,_,g,d,l[p+15],16,530742520),g=o(g,d=s(d,h,_,g,l[p+2],23,3299628645),h,_,l[p+0],6,4096336452),_=o(_,g,d,h,l[p+7],10,1126891415),h=o(h,_,g,d,l[p+14],15,2878612391),d=o(d,h,_,g,l[p+5],21,4237533241),g=o(g,d,h,_,l[p+12],6,1700485571),_=o(_,g,d,h,l[p+3],10,2399980690),h=o(h,_,g,d,l[p+10],15,4293915773),d=o(d,h,_,g,l[p+1],21,2240044497),g=o(g,d,h,_,l[p+8],6,1873313359),_=o(_,g,d,h,l[p+15],10,4264355552),h=o(h,_,g,d,l[p+6],15,2734768916),d=o(d,h,_,g,l[p+13],21,1309151649),g=o(g,d,h,_,l[p+4],6,4149444226),_=o(_,g,d,h,l[p+11],10,3174756917),h=o(h,_,g,d,l[p+2],15,718787259),d=o(d,h,_,g,l[p+9],21,3951481745),g=i(g,v),d=i(d,f),h=i(h,y),_=i(_,m);return 32==t?c(g)+c(d)+c(h)+c(_):c(d)+c(h)}var A=new(function(){function e(){i(this,e),this.sessionId="",this.sessionDate=""}return c(e,[{key:"setId",value:function(){var e=+new Date;return this.sessionId=T("WeChat"+e.toString()+Math.random(0,1e7)),this.sessionDate=e,v.setLocal("SEESIONID",this.sessionId),v.setLocal("SEESIONDATE",this.sessionDate),this.sessionId}},{key:"getId",value:function(){var e=new Date,t=e.getTime(),r=e.getTimezoneOffset(),a=new Date(t+60*r*1e3+288e5).getDate();this.sessionDate=v.getLocal("SEESIONDATE")||0;var n=0===this.sessionDate?0:new Date(this.sessionDate+60*r*1e3+288e5).getDate();return(""===this.sessionId||0===this.sessionDate||18e5<Number(t)-Number(this.sessionDate)||n!==a)&&this.setId(),this.sessionDate=t,v.setLocal("SEESIONDATE",t),this.sessionId=v.getLocal("SEESIONID")||this.setId(),this.sessionId}}]),e}()),_=new(function(){function e(){i(this,e)}return c(e,[{key:"getId",value:function(){var e=v.getLocal("ARK_LOGINID")||v.getLocal("ARK_TRACKID")||v.getLocal("ARK_ID");return e||(e=this.setId(),v.setLocal("ARK_ID",e)),e}},{key:"setId",value:function(){var e=new String((new Date).getTime())+new String(1e4*Math.random());return"DD"+T(new String(e),32)+T(new String(e),32).slice(0,4)}},{key:"jsId",value:function(){return v.getLocal("ARK_ID")||this.setId()}},{key:"removeARKId",value:function(){v.removeLocal("ARK_ID")}},{key:"setLoginId",value:function(e){e&&v.setLocal("ARK_LOGINID",e)}},{key:"setLoginOId",value:function(e){e&&v.setLocal("ARK_LOGINOID",e)}},{key:"getLoginOId",value:function(){return v.getLocal("ARK_LOGINOID")}},{key:"getLoginId",value:function(){return v.getLocal("ARK_LOGINID")}},{key:"removeLoginId",value:function(){v.removeLocal("ARK_LOGINID")}},{key:"setTrackId",value:function(e){e&&v.setLocal("ARK_TRACKID",e)}},{key:"getTrackId",value:function(){return v.getLocal("ARK_TRACKID")}},{key:"removeTrackId",value:function(){v.removeLocal("ARK_TRACKID")}},{key:"getAliasId",value:function(){return v.getLocal("ARK_LOGINID")}},{key:"removeAliasId",value:function(){v.removeLocal("ARK_LOGINID")}},{key:"setIdentifyId",value:function(e){v.setLocal("ARK_TRACKID",e)}},{key:"getIdentifyId",value:function(){return v.getLocal("ARK_TRACKID")}},{key:"removeIdentifyId",value:function(){v.removeLocal("ARK_TRACK_LOGIN")}}]),e}()),$={utm_campaign_id:"",utm_source:"",utm_medium:"",utm_term:"",utm_content:"",utm_campaign:""},k=p.Router.getPath,R=p.Router.getScene,L=(p.Router.getPackageName,p.Router.getTitle,p.Router.getReferer),E=t.base;function I(){return t.system.system.language||""}var O="GMT"+f.clientTimeZone();function P(){var e=f.format(new Date,"yyyy-MM-dd hh:mm:ss.SSS");return t.base.allowTimeCheck&&t.base.logflag&&(e=f.format(new Date(+new Date+(v.getLocal("ANSSERVERTIME")?Number(v.getLocal("ANSSERVERTIME")):0)),"yyyy-MM-dd hh:mm:ss.SSS")),v.getLocal("ARKFRISTPROFILE")&&(e=v.getLocal("ARKFRISTPROFILE")),e}var D=v.getData("UTMSESSION")||"";$.utm_campaign&&$.utm_source&&$.utm_medium?(D!==JSON.stringify($)&&A.setId(),v.setData("UTMSESSION",JSON.stringify($))):($={utm_campaign_id:"",utm_source:"",utm_medium:"",utm_term:"",utm_content:"",utm_campaign:""},v.removeData("UTMSESSION"));var N={resetKeywords:["appid","$debug","uploadUrl"],uploadURL:{valueType:0,value:function(){return"/"!==E.uploadURL.charAt(E.uploadURL.length-1)&&(E.uploadURL+="/"),E.uploadURL},check:{value:["isString","nimLength","isUrl"],errorCode:"60007",successCode:"20008"}},appid:{valueType:0,value:function(){return E.appid},check:{value:["isString","nimLength"],errorCode:"60006",successCode:"20006"}},auto:{check:{value:["isBoolean"],errorCode:"60003"}},autoProfile:{check:{value:["isBoolean"],errorCode:"60003"}},xwho:{valueType:0,value:function(){return _.getId()},check:{value:["isString","nimLength"]}},xwhen:{valueType:0,value:function(){return t.base.allowTimeCheck&&t.base.logflag?+new Date+(v.getLocal("ANSSERVERTIME")?Number(v.getLocal("ANSSERVERTIME")):0):+new Date}},xwhat:{valueType:0,value:function(){return t.status.FnName},check:{value:["isString","nimLength"]}},xcontext:{$lib:{valueType:1,value:"DingTalk"},$lib_version:{valueType:0,value:function(){return E.$lib_version},check:{value:["isString"],successCode:"20007"}},$platform:{valueType:1,value:"DingTalk"},$debug:{valueType:0,value:function(){return E.$debug},check:{value:["isNumber","isDebug"]}},$is_login:{valueType:0,value:function(){return!(!_.getAliasId()&&!v.getLocal("ARK_TRACK_LOGIN"))},check:{value:["isBoolean"]}},$screen_width:{valueType:0,value:function(){return t.system.system.screenWidth||""},check:{value:["isNumber"]}},$screen_height:{valueType:0,value:function(){return t.system.system.screenHeight||""},check:{value:["isNumber"]}},$time_zone:{valueType:1,value:O},$os:{valueType:0,value:function(){return t.system.system.system?t.system.system.system.split(" ")[0]:""},check:{value:["isString"]}},$browser:{valueType:0,value:function(){return t.system.system.browser||""}},$brand:{valueType:0,value:function(){return t.system.system.brand||""},check:{value:["isString"]}},$browser_version:{valueType:0,value:function(){return t.system.system.version||""},check:{value:["isString"]}},$os_version:{valueType:0,value:function(){return t.system.system.system?t.system.system.system.split(" ")[1]:""},check:{value:["isString"]}},$model:{valueType:0,value:function(){return t.system.system.model||""},check:{value:["isString"]}},$language:{valueType:0,value:I,check:{value:["isString"]}},$network:{valueType:0,value:function(){return t.system.netWork.networkType},check:{value:["isString"]}},$session_id:{valueType:0,value:function(){return A.getId()}},$scene:{valueType:0,value:R},$referrer:{valueType:0,value:function(){return L()||R()}},$startup_time:{valueType:0,value:P},$is_first_time:{valueType:0,value:function(){var e=v.getLocal("FRISTIME");return v.setLocal("FRISTIME",!1),null==e||e}},$is_first_day:{valueType:0,value:function(){var e=new Date;t.base.allowTimeCheck&&t.base.logflag&&(e=new Date(+new Date+(v.getLocal("ANSSERVERTIME")?Number(v.getLocal("ANSSERVERTIME")):0)));var r=e.getFullYear(),a=e.getMonth()+1;a=a<10?"0"+a:a;var n=e.getDate(),s=r+""+a+(n=n<10?"0"+n:n),o=v.getLocal("FRISTDAY");return!(o&&s!==o||(v.setLocal("FRISTDAY",s),0))}},$first_visit_time:{valueType:0,value:P},$original_id:{valueType:0,value:function(){return _.getTrackId()||_.jsId()},check:{value:["isString"]}},$is_time_calibrated:{valueType:0,value:function(){return!!(v.getLocal("ANSSERVERTIME")&&t.base.allowTimeCheck&&t.base.logflag)}},$url:{valueType:0,value:function(){return k()||""}},$utm_campaign_id:{valueType:0,value:function(){return $.utm_campaign_id}},$utm_source:{valueType:0,value:function(){return $.utm_source}},$utm_medium:{valueType:0,value:function(){return $.utm_medium}},$utm_term:{valueType:0,value:function(){return $.utm_term}},$utm_content:{valueType:0,value:function(){return $.utm_content}},$utm_campaign:{valueType:0,value:function(){return $.utm_campaign}},$share_id:{valueType:0,value:function(){return t.base.$share_id}},$share_level:{valueType:0,value:function(){return t.base.$share_level}},$share_path:{valueType:0,value:function(){return t.base.$share_path}}},xcontextCommonRule:{check:{key:["isString","length99","notSpecialCharacters","keywords"],value:["notObject","isArrayString","length255"]}},$track:{check:{key:["isString","notSpecialCharacters","length99"]}},$alias:{check:{key:["isString","keyLength255"]}},$profile_increment:{check:{key:["isString","length99","notSpecialCharacters"],value:["isNumber"]}},$profile_unset:{check:{key:["isString","length99","notSpecialCharacters"]}},$pageview:{check:{key:["isString","keyLength255"]}}};function w(e,t){for(var r=0;r<t.length;r++)if(!b[t[r]](e))return!1;return!0}function F(e,r,a){var n=a.check,s=!0;if(!n)return s;var o=n.key,u=n.value;if(o&&(s=w(e,o),t.status.key=e,s||(t.status.code=400,S())),u){if(t.status.code=200,r&&"Array"==f.paramType(r)){t.status.key=e;for(var i=0;i<r.length;i++)(s=w(r[i],["isString","length255"]))||(t.status.value=r[i],"String"!==f.paramType(r[i])&&(t.status.errorCode="600013"),500<r[i].length&&(r[i]=f.stringSlice(r[i],499)+"$"),t.status.code=400,S());return s}s=w(r,u),"Array"!==f.paramType(r)&&(t.status.value=r),s||(t.status.code=400,S())}return s}function x(e,t){var r=t||N,a={};for(var n in e){var s=e[n],o=r[n];if(o){var u="";if("Object"===f.paramType(s)){var i=x(s,o);a[n]=i}else f.objHasKay(o,"valueType")&&(0===o.valueType&&(u=o.value(),"String"==f.paramType(u)&&500<u.length?a[n]=f.stringSlice(u,499)+"$":a[n]=u),1===o.valueType&&(u=o.value,"String"==f.paramType(u)&&500<u.length?a[n]=f.stringSlice(u,499)+"$":a[n]=u))}}return a}function j(){t.status={code:200,FnName:t.status.FnName,key:"",value:"",errorCode:"",successCode:""}}function C(e,r,a,n){j();var s=N[r]||N.xcontextCommonRule;if("Object"!==f.paramType(e)||1==a){var o=w(e,s.check.key);return t.status.key=e,!(!o&&(S(),"aliasId"==n||"distinctId"==n))}for(var u in 0==Object.keys(e).length&&(t.status.errorCode=600021,t.status.value=0,S()),e)o=F(u,e[u],s),"$lib"!=u&&"$lib_version"!=u&&"$platform"!=u||(e[u]=t.base[u]),o||"600019"===t.status.errorCode&&500<e[u].length&&(e[u]=f.stringSlice(e[u],499)+"$");return!0}for(var M=[],K={base:{outer:["appid","xwho","xwhat","xwhen","xcontext"],xcontext:["$lib","$lib_version","$platform","$debug","$is_login"]},$startup:{xcontext:["$brand","$model","$os","$os_version","$browser","$browser_version","$network","$screen_width","$screen_height","$utm_campaign_id","$utm_campaign","$utm_medium","$utm_source","$utm_content","$utm_term","$is_first_day","$time_zone","$language","$session_id","$is_time_calibrated","$is_first_time","$referrer","$scene"]},$track:{xcontext:["$brand","$model","$os","$os_version","$browser","$browser_version","$network","$screen_width","$screen_height","$utm_campaign_id","$utm_campaign","$utm_medium","$utm_source","$utm_content","$utm_term","$is_first_day","$time_zone","$language","$session_id","$is_time_calibrated"]},$pageview:{xcontext:["$brand","$model","$os","$os_version","$browser","$browser_version","$network","$screen_width","$screen_height","$utm_campaign_id","$utm_campaign","$utm_medium","$utm_source","$utm_content","$utm_term","$is_first_day","$time_zone","$language","$session_id","$is_time_calibrated","$referrer","$scene","$startup_time","$url","$share_id","$share_path","$share_level"]},$alias:{xcontext:["$original_id"]},$getPresetProperties:{xcontext:["$time_zone","$language","$screen_width","$screen_height","$network","$first_visit_time","$brand","$model","$os","$session_id"]}},U=0;U<M.length;U++)K=f.objMerge(e,M[U]);var V={},Y={},q=K.base,G=q.outer;for(U=0;U<G.length;U++)q[G[U]]?Y[G[U]]=f.toObj(q[G[U]]):Y[G[U]]="";for(var J in K)"base"!=J&&(V[J]=f.objMerge(Y,f.toDeepObj(K[J])));function B(e){return V[e]||V.commonTemp}V.commonTemp=Y;var W=p.getPublicApp,z=p.Fetch.request,H=!0;function Z(e){if("Object"!==f.paramType(e)||f.isEmptyObject(e))return!1;for(var r=!0,a=0;a<t.baseJson.length;a++){var n=t.baseJson[a];"xwhat"!==n&&(!e[n]||"Object"==f.paramType(e[n])&&f.isEmptyObject(e[n]))&&(r=!1)}return r}function Q(e){var r=v.getLocal("POSTDATA")||[],a=[];if(0<r.length)for(var n=0;n<r.length;n++)"Array"===f.paramType(r[n])?a.push.apply(a,r[n]):"Object"===f.paramType(r[n])&&Z(r[n])&&a.push(r[n]);r.length<=500&&0<Object.keys(e).length&&a.push(e),v.setLocal("POSTDATA",a),!0===H&&function s(e){v.removeLocal("POSTDATA"),j(),H=!1;var o=e,r={url:t.base.uploadURL+"?appid="+t.base.appid,data:e,encryptType:t.base.encryptType};W().AnalysysAgent.encrypt&&"Function"===f.paramType(W().AnalysysAgent.encrypt.uploadData)&&(r=W().AnalysysAgent.encrypt.uploadData(r)),t.status.key=r.url,t.status.value=JSON.stringify(e),t.status.successCode="20012",d(),z({url:r.url,method:"POST",data:JSON.stringify(r.data),dataType:"json",success:function(e){if(H=!0,"String"==f.paramType(e.data)&&(W().AnalysysAgent.encrypt&&"Function"==f.paramType(W().AnalysysAgent.encrypt.decodeRes)?e.data=JSON.parse(W().AnalysysAgent.encrypt.decodeRes(e.data)):"H4sIAAAAAAAAAKtWSs5PSVWyMjIwqAUAVAOW6gwAAAA="==e.data?e.data={code:200}:"H4sIAAAAAAAAAKtWSs5PSVWyMjUwqAUA7TtBdwwAAAA="==e.data?e.data={code:500}:"H4sIAAAAAAAAAKtWSs5PSVWyMjEy0FHKLU5XslJySSxJVHBJTS6qLChRcC0qyi/S01OqBQBdATGSKQAAAA=="==e.data?e.data={code:420}:e.data={code:200}),200==e.data.code||500==e.data.code||420==e.data.code){var r=v.getLocal("POSTDATA")||[];0<r.length&&s(r),200==e.data.code?(t.status.successCode="20001",d()):(t.status.errorCode="60008",S())}else{t.status.errorCode="60008",S();var a=v.getLocal("POSTDATA")||[],n=[].concat(l(o),l(a));v.setLocal("POSTDATA",n),0<a.length&&s(n)}},fail:function(){H=!0,t.status.errorCode="60008",S();var e=v.getLocal("POSTDATA")||[],r=[].concat(l(o),l(e));v.setLocal("POSTDATA",r),0<e.length&&s(r)}})}(a)}function X(e,r){t.status.FnName="$profile_set_once",j();var a=f.toObj(e,r);C(a);var n=x(B("$profile_set_once"));(n=f.delEmpty(n)).xcontext=f.objMerge(n.xcontext,a),Q(n)}function ee(e,r){t.status.FnName="$pageview",j();var a={$title:""};0<arguments.length&&C(a={$title:e}),1<arguments.length&&C(r);var n=x(B("$pageview"));n=f.delEmpty(n);var s=v.getLocal("ARKSUPER")||{};0<Object.keys(s).length&&(n.xcontext=f.objMerge(n.xcontext,s));var o=t.base.appProperty;"Object"==f.paramType(o)&&o&&(n.xcontext=f.objMerge(n.xcontext,o)),n.xcontext=f.objMerge(n.xcontext,r||{}),e&&"String"==f.paramType(e)&&(n.xcontext=f.objMerge(n.xcontext,a||{})),Q(n)}function te(e){var r=f.format(new Date,"yyyy-MM-dd hh:mm:ss.SSS");t.base.allowTimeCheck&&t.base.logflag&&(r=f.format(new Date(+new Date+(v.getLocal("ANSSERVERTIME")?Number(v.getLocal("ANSSERVERTIME")):0)),"yyyy-MM-dd hh:mm:ss.SSS"));var a={$first_visit_time:v.getLocal("ARKFRISTPROFILE")||r,$first_visit_language:I()},n=t.base.autoProfile,s=t.base.auto;if("startUp"==e){if(!0===n&&0==(v.getLocal("ARKFRISTPROFILESEND")||!1)){v.setLocal("ARKFRISTPROFILESEND",!0),t.status.FnName="$profile_set_once",j();var o=x(B("$profile_set_once"));(o=f.delEmpty(o)).xcontext=f.objMerge(o.xcontext,a);var u=v.getLocal("POSTDATA");u=[].concat(l(u),l(f.objInArray(o))),v.setLocal("POSTDATA",u)}!0===s?ee():Q({})}else{if("alias"!=e)return;1==t.base.autoProfile&&(v.setLocal("ARKFRISTPROFILESEND",!0),X(a))}}var ae=p.setPublicApp;function re(e){var r,a;e&&((a=r=e)&&"create"==r._status&&(ae(r),a=r.options),a.query&&0<Object.keys(a.query).length&&(a.query.utm_campaign&&a.query.utm_medium&&a.query.utm_source&&($.utm_campaign_id=a.query.campaign_id,$.utm_campaign=a.query.utm_campaign,$.utm_content=a.query.utm_content,$.utm_medium=a.query.utm_medium,$.utm_source=a.query.utm_source,$.utm_term=a.query.utm_term),a.query.share_id&&a.query.share_level&&a.query.share_path&&(t.base.$share_id=a.query.share_id,t.base.$share_level=a.query.share_level,t.base.$share_path=decodeURIComponent(a.query.share_path))),a.scene&&(t.system.scene=r.scene));var n=v.getLocal("ARKAPPID"),s=v.getLocal("ARKDEBUG"),o=v.getLocal("ARKUPLOADURL");if(n&&"Number"==f.paramType(s)&&o&&(n!==t.base.appid||1===s&&s!==t.base.$debug||o!==t.base.uploadURL)&&(f.delFristDay(),f.delFristTime(),v.removeLocal("ARKFRISTPROFILE"),v.removeLocal("ARKFRISTPROFILESEND"),_.removeLoginId(),_.removeTrackId(),v.removeLocal("ARK_TRACK_LOGIN"),v.removeLocal("ARKSUPER"),v.removeData("STARTUP"),v.removeData("STARTUPTIME"),v.removeLocal("POSTDATA")),f.setFristDay(),f.setFristTime(),t.base.allowTimeCheck||v.removeLocal("ANSSERVERTIME"),v.setLocal("ARKDEBUG",t.base.$debug),v.setLocal("ARKAPPID",t.base.appid),v.setLocal("ARKUPLOADURL",t.base.uploadURL),!1!==v.getData("STARTUP")){for(var u=t.FnSuperCatch,i=0;i<u.length;i++)u[i][0].apply(u[i][0],u[i][1]);t.FnSuperCatch=[],t.isStartUp=!0,t.status.FnName="$startup",j(),A.setId(),v.setData("STARTUP",!1);var c=x(B("$startup"));c=f.delEmpty(c),v.getLocal("ARKFRISTPROFILE")||v.setLocal("ARKFRISTPROFILE",f.format(new Date(c.xwhen),"yyyy-MM-dd hh:mm:ss.SSS"));var p=v.getLocal("ARKSUPER")||{};c.xcontext=f.objMerge(c.xcontext,p);var y=t.base.appProperty||{};if(c.xcontext=f.objMerge(c.xcontext,y),v.setData("STARTUPTIME",f.format(new Date(c.xwhen),"yyyy-MM-dd hh:mm:ss.SSS")),1!=t.base.autoProfile&&1!=t.base.auto)Q(c);else{var m=v.getLocal("POSTDATA")||[];m=[].concat(l(m),l(f.objInArray(c))),v.setLocal("POSTDATA",m),te("startUp")}var g=t.FnCatch;for(i=0;i<g.length;i++)g[i][0].apply(g[i][0],g[i][1]);t.FnCatch=[]}else 1==t.base.auto&&ee()}function ne(e,r){t.status.FnName="$registerSuperProperty",j();var a=f.toObj(e,r);C(a);var n=v.getLocal("ARKSUPER")||{},s=f.objMerge(n,a);v.setLocal("ARKSUPER",s),t.status.successCode="20002",t.status.value=JSON.stringify(a),d()}function se(e){t.status.FnName="$unregisterSuperProperty",j(),C(e);var r=v.getLocal("ARKSUPER")||{};if(!r.hasOwnProperty(e))return t.status.successCode="20011",void(t.status.value=e);delete r[e],v.setLocal("ARKSUPER",r),t.status.successCode="20003",t.status.value=e,d()}function oe(e,r){t.status.FnName="$registerSuperProperties",j();var a=f.toObj(e,r);C(a);var n=v.getLocal("ARKSUPER")||{},s=f.objMerge(n,a);v.setLocal("ARKSUPER",s),t.status.successCode="20002",t.status.value=JSON.stringify(a),d()}function ue(e){t.status.FnName="$getSuperProperty",j(),C(e,"$getSuperProperty",!0);var r=v.getLocal("ARKSUPER")||{},a=r[e];return r.hasOwnProperty(e)?(t.status.successCode="20010",t.status.value=a,t.status.key=e,d(),a):(t.status.successCode="20009",t.status.key=e,d(),"")}function ie(){t.status.FnName="$getSuperProperties",j();var e=v.getLocal("ARKSUPER")||{};return t.status.successCode="20010",t.status.value=JSON.stringify(e),d(),e}function ce(){t.status.FnName="$clearSuperProperties",j(),v.setLocal("ARKSUPER",{}),t.status.successCode="20004",d()}function le(e){if(t.status.FnName="$alias",j(),C(e,"$alias",!0,"aliasId")){v.setLocal("ARK_LOGINID",e);var r=x(B("$alias"));r=f.delEmpty(r),1!=t.base.autoProfile?Q(r):(v.setLocal("POSTDATA",f.objInArray(r)),te("alias"))}}function pe(e,r){t.status.FnName=e,j(),C(e,"$track",!0),1<arguments.length&&C(r);var a=x(B("$track")),n=v.getLocal("ARKSUPER")||{};a.xcontext=f.delEmpty(a.xcontext),0<Object.keys(n).length?(n=f.objMerge(n,r),a.xcontext=f.objMerge(a.xcontext,n)):a.xcontext=f.objMerge(a.xcontext,r),Q(a)}function ye(e,r){t.status.FnName="$identify",j(),C(e,"$alias",!0,"distinctId")&&(!0===r&&v.setLocal("ARK_TRACK_LOGIN",!0),v.setLocal("ARK_TRACKID",e),t.status.successCode="20002",t.status.value=e,d())}function ge(){var e=f.format(new Date,"yyyy-MM-dd hh:mm:ss.SSS");t.base.allowTimeCheck&&t.base.logflag&&(e=+new Date+(v.getLocal("ANSSERVERTIME")?Number(v.getLocal("ANSSERVERTIME")):0)),e=f.format(new Date(e),"yyyy-MM-dd hh:mm:ss.SSS"),j(),_.removeARKId(),_.removeTrackId(),_.removeLoginId(),_.removeIdentifyId(),ce(),function(e){if(!(e=e||!1)){var r=t.base;for(var a in r)"Object"!==f.paramType(r[a])&&("$debug"!==a&&"appid"!==a&&"uploadURL"!==a||(Storage.getLocal("ANS"+a.toUpperCase())!==r[a]&&(e=!0),e&&Storage.setLocal("ANS"+a.toUpperCase(),r[a])))}if(e){if(v.removeLocal("ARKSUPER"),v.removeData("STARTUP"),v.setLocal("FRISTDAY",f.format(new Date,"yyyyMMdd")),t.base.allowTimeCheck&&t.base.logflag){var n=f.format(new Date(+new Date+(v.getLocal("ANSSERVERTIME")?Number(v.getLocal("ANSSERVERTIME")):0)),"yyyyMMdd");v.setLocal("FRISTDAY",n)}v.setLocal("FRISTIME",!0),v.removeLocal("POSTDATA"),v.removeLocal("ANSSERVERTIME"),v.removeLocal("ARKFRISTPROFILE"),v.removeLocal("ARKFRISTPROFILESEND")}}(!0),A.setId(),!0===t.base.autoProfile&&X({$reset_time:e}),t.status.FnName="$reset",t.status.successCode="20005",d()}function ve(e,r){t.status.FnName="$profile_set",j();var a=f.toObj(e,r);C(a);var n=x(B("$profile_set"));(n=f.delEmpty(n)).xcontext=f.objMerge(n.xcontext,a),Q(n)}function fe(e,r){t.status.FnName="$profile_increment",j();var a=f.toObj(e,r);C(a,"$profile_increment");var n=x(B("$profile_increment"));(n=f.delEmpty(n)).xcontext=f.objMerge(n.xcontext,a),Q(n)}function me(e,r){t.status.FnName="$profile_append",j();var a=f.toObj(e,r);C(a);var n=x(B("$profile_append"));(n=f.delEmpty(n)).xcontext=f.objMerge(n.xcontext,a),Q(n)}function he(e){t.status.FnName="$profile_unset",j();var r=f.toObj(e,"");C(r,"$profile_unset");var a=x(B("$profile_unset"));(a=f.delEmpty(a)).xcontext=f.objMerge(a.xcontext,r),Q(a)}function de(){t.status.FnName="$profile_delete",j();var e=x(B("$profile_delete"));Q(e=f.delEmpty(e))}var Se=p.Fetch.request,be=function(){return new Promise(function(o){if(j(),!t.base.allowTimeCheck)return o();var e=t.base.uploadURL;e=e.split("up")[0],Se({url:e+"configure",method:"GET",success:function(e){o(e);var r=e.header||e.headers;if(r&&r.Date){var a=+new Date,n=r.Date,s=t.base.maxDiffTimeInterval;s<0&&(s=30),n&&s<Math.abs((new Date(n)-a)/1e3)&&(t.base.logflag||(v.setLocal("ANSSERVERTIME",new Date(n)-a),t.status.successCode="20013",t.status.value=f.format(new Date(n),"yyyy-MM-dd hh:mm:ss +SSS"),t.status.key=f.format(new Date(a),"yyyy-MM-dd hh:mm:ss +SSS"),t.status.FnName=(new Date(n)-a)/1e3+"s",d(),t.base.logflag=!0))}},fail:function(e){o(e)}})}).catch(function(e){})},Te=p.System.systemPromise,Ae=p.Network.netWorkPromise;function _e(e){var r=_.getId();if(!t.base.autoShare)return e;var a=p.Router.getPath();Promise.all([Te(),Ae(),be(),v.initLocalData()]).then(function(e){pe("$share",{$share_id:r,$share_level:Number(t.base.$share_level)+1,$share_path:a})});var n="share_id="+r+"&share_level="+(Number(t.base.$share_level)+1)+"&share_path="+encodeURIComponent(a);return e.path?-1<e.path.indexOf("?")?e.path=e.path+"&"+n:e.path=e.path+"?"+n:e.path=a+"?"+n,e}function $e(e){if(j(),t.status.FnName="$appProperty","Object"!=f.paramType(e)||!e)return t.status.errorCode="600016",void(t.status.value=JSON.stringify(e));if(C(e),t.base.appProperty)for(var r in e)t.base.appProperty[r]=e[r];else t.base.appProperty=e;t.status.successCode="20002",t.status.value=JSON.stringify(e),d()}function ke(){return _.getTrackId()||_.jsId()}function Re(){t.status.FnName="getPresetProperties",j();var e=x(B("$getPresetProperties"));return delete(e=f.delEmpty(e)).xcontext.$is_login,t.status.successCode="20010",t.status.value=JSON.stringify(e.xcontext),d(),e.xcontext}var Le=p.System.systemPromise,Ee=p.Network.netWorkPromise,Ie=!0,Oe=[];function Pe(a,n,s){return function(){var r=arguments;1!=Ie||0!==Object.keys(t.system.system).length&&0!==Object.keys(t.system.netWork).length?!n&&1!=t.isStartUp||1!=Ie?1==s?t.FnSuperCatch.push([a,arguments]):1==Ie&&!1===s?Oe.push([a,arguments]):t.FnCatch.push([a,arguments]):a.apply(a,arguments):Promise.all([Le(),Ee(),be(),v.initLocalData()]).then(function(e){Ie=!0,t.system.system=e[0],t.system.netWork=e[1],0<Oe.length&&(Oe[0][0](Oe[0][1]),Oe=[]),s&&1!=t.isStartUp?t.FnSuperCatch.push([a,r]):n||1==t.isStartUp?a.apply(a,r):t.FnCatch.push([a,r])}).catch(function(e){console.log(e.message)})}}var De=function e(){i(this,e),this.appStart=Pe(re,!0,!1),this.startUp=Pe(re,!0),this.pageView=Pe(ee,!1),this.registerSuperProperty=Pe(ne,!1,!0),this.unRegisterSuperProperty=Pe(se,!1,!0),this.registerSuperProperties=Pe(oe,!1,!0),this.getSuperProperty=ue,this.getSuperProperties=ie,this.clearSuperProperties=Pe(ce,!1,!0),this.alias=Pe(le,!0),this.track=Pe(pe,!1),this.identify=Pe(ye,!1,!0),this.reset=ge,this.profileSet=Pe(ve,!1),this.profileSetOnce=Pe(X,!1),this.profileIncrement=Pe(fe,!1),this.profileAppend=Pe(me,!1),this.profileUnset=Pe(he,!1),this.profileDelete=Pe(de,!1),this.share=_e,this.appProperty=$e,this.getDistinctId=ke,this.getPresetProperties=Re},Ne=p.getPublicApp;t.isStartUp=!0,t.base.auto=!1;var we=new(function(){function e(){return i(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,De),c(e,[{key:"appkey",set:function(e){j(),t.status.FnName="appkey",t.status.successCode="20002",t.status.value=e,d(),t.status.successCode="20007",t.status.value=t.base.$lib_version,d(),t.base.appid=e},get:function(){return t.base.appid}},{key:"debugMode",set:function(e){j(),t.base.$debug=e},get:function(){return t.base.$debug}},{key:"uploadURL",set:function(e){return j(),e?(f.checkURL(e)?("/"!==e.charAt(e.length-1)&&(e+="/"),t.base.uploadURL=e+"up",t.status.successCode="20008"):(t.status.errorCode="600011",t.status.key="uploadURL"),void(t.status.value=e)):void(t.status.errorCode="60007")},get:function(){return t.base.uploadURL}},{key:"autoProfile",set:function(e){if(j(),"Boolean"!==f.paramType(e))return t.status.key="autoProfile",t.status.errorCode="60003",void(t.status.value=e);t.base.autoProfile=e},get:function(){return t.base.autoProfile}},{key:"encryptType",set:function(e){if(j(),"Number"!==f.paramType(e))return t.status.key="encryptType",t.status.errorCode="60002",void(t.status.value=e);t.base.encryptType=e},get:function(){return t.base.encryptType}},{key:"autoShare",set:function(e){if(j(),"Boolean"!==f.paramType(e))return t.status.key="autoShare",t.status.errorCode="60003",void(t.status.value=e);t.base.autoShare=e},get:function(){return t.base.autoShare}},{key:"allowTimeCheck",set:function(e){if(j(),"Boolean"!==f.paramType(e))return t.status.key="allowTimeCheck",t.status.errorCode="60003",void(t.status.value=e);t.base.allowTimeCheck=e},get:function(){return t.base.maxDiffTimeInterval}},{key:"maxDiffTimeInterval",set:function(e){if(j(),"Number"!==f.paramType(e))return t.status.key="maxDiffTimeInterval",t.status.errorCode="60002",void(t.status.value=e);t.base.maxDiffTimeInterval=e}}]),e}());delete we.startUp;var Fe=Ne();Fe&&(Fe.AnalysysAgent=we),module.exports=we;